


# 성능 개선을 위한 캐싱 및 Redis 활용 로직

### 목표
    - 조회가 오래 걸리는 쿼리에 대한 캐싱을 통해 성능을 개선.
    - Redis를 이용한 로직 이관을 통해 대기열 관리 성능을 개선.
### 현재 문제
    - 콘서트 조회 쿼리가 오래 걸려 사용자 경험이 저하되고 서버 부하가 증가.
    - 대기열 관리에서 실시간으로 변동되는 데이터를 효율적으로 관리할 필요가 있음.
### 개선 방안
#### 콘서트 조회 캐싱
    1. 이유
    - 콘서트 정보는 자주 변하지 않는 데이터.
    - 데이터베이스에 자주 접근하지 않고도 빠르게 조회할 수 있도록 캐싱.
    
    2. 솔루션
    - 콘서트 조회 결과를 Redis에 캐싱.
    - 캐시가 만료되면 데이터베이스에서 데이터를 다시 가져와 캐싱.
    
    3. 캐시설정
    - Redis 캐시 TTL(Time-To-Live)을 24시간으로 설정하여, 캐시된 데이터가 한 시간 동안 유효하도록 함.
#### 대기열 관리
    1. 이유
    - 대기열은 실시간으로 변동되는 데이터이므로 Redis를 활용하여 성능을 개선.
    - Redis의 ZSet을 사용하여 대기열을 효율적으로 관리.
    
    2. 솔루션
    - 각 콘서트별 대기열을 Redis ZSet으로 관리하여 순서대로 관리한다.
    - 추가로 각 토큰마다 value ops에 TTL을 추가하여 대기중인 상태에서 기본 만료되도록한다.
    - ZADD 명령어로 신규 대기열을 추가
    - ZRANK 명령어로 토큰 조회에 내 앞 대기인원을 계산
    - ZRANGE 명령어로 Active 토큰으로 활성화할 목록을 가지고 옴
    - 각 콘서트마다 대기중인 토큰 개수의 비율을 구하고, 최대 활성화 가능 토큰 수를 해당 비율에 맞춰 콘서트별 활성화시킬 토큰수를 계산하고 대기중인 토큰을 활성화시킨다.
    - 활성화 된 토큰은 Set 에 저장하여 관리한다.
    - 추가로 각 토큰마다 value ops에 TTL을 추가하여 활성화 상태에서 일정시간이 지나면 만료되도록한다.
    - value ops에서 사라진 토큰과 Set에 있는 토큰을 비교하여 일정 주기마다 만료된 토큰을 지운다.
### 결론
    - 콘서트 조회는 캐싱을 통해 성능을 개선하고 데이터베이스 부하를 줄임.
    - 대기열 관리는 Redis ZSet을 활용하여 효율적으로 관리하고, TTL을 통해 만료된 항목을 자동으로 제거함으로써 일관성을 유지.
    - 이러한 접근 방식을 통해 시스템 성능을 크게 향상시킬 수 있음.


---